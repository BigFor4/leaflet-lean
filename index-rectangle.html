<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Display HTML Overlay with Zoom</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        .leaflet-div-overlay {
            background: white;
            border: 1px solid black;
            padding: 10px;
            pointer-events: auto;
            cursor: move;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            transform-origin: top left;
        }

        .centered-overlay {
            transform-origin: center;
        }

        .resize-handle {
            width: 10px;
            height: 10px;
            background: red;
            position: absolute;
            cursor: nwse-resize;
            z-index: 10;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <p><a href="https://www.maptiler.com/copyright/" target="_blank" rel="noopener">&copy; MapTiler</a> <a
            href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">&copy; OpenStreetMap
            contributors</a></p>

    <script>
        const map = L.map('map').setView([49.2125578, 16.62662018], 14);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const latLng = L.latLng(49.2125578, 16.62662018);

        L.TextBox = L.Layer.extend({
            initialize: function (htmlElement, latLng, options) {
                const divText = document.createElement('div');
                divText.id = 'customOverlayTextBoxDiv';
                divText.style.height = '100%';
                divText.style.overflow = 'hidden';
                const overlay = document.createElement('div');
                overlay.id = 'customOverlayTextBox';
                overlay.style.height = '100%';
                overlay.appendChild(divText);
                divText.appendChild(htmlElement);
                this._htmlElement = overlay;
                this._latLng = latLng;
                L.setOptions(this, options);
                this._dragging = false;
                this._resize = false;
            },

            onAdd: function (map) {
                this._map = map;
                if (!this._container) {
                    this._initLayout();
                }
                map.getPanes().overlayPane.appendChild(this._container);
                this._update();
                map.on('zoomend', this._update, this);

                this._container.addEventListener('mousedown', this._startDrag.bind(this));
            },

            onRemove: function (map) {
                if (this._container) {
                    map.getPanes().overlayPane.removeChild(this._container);
                }
                map.off('zoomend', this._update, this);
            },

            _initLayout: function () {
                this._container = this._htmlElement;
                L.DomUtil.addClass(this._container, 'leaflet-div-overlay');
                L.DomUtil.addClass(this._container, 'centered-overlay');
                this._container.style.position = 'absolute';

                this._createResizeHandles();
            },

            _createResizeHandles: function () {
                if (this.options.editing) {
                    const positions = ['top-left', 'top-right', 'bottom-left', 'bottom-right',
                        'top-middle', 'bottom-middle', 'left-middle', 'right-middle'];
                    positions.forEach((position) => {
                        const handle = document.createElement('div');
                        handle.className = 'resize-handle';
                        handle.style.backgroundColor = position.includes('middle') ? 'blue' : 'red';

                        // Set position styles
                        if (position.includes('top')) handle.style.top = '-5px';
                        if (position.includes('bottom')) handle.style.bottom = '-5px';
                        if (position.includes('left')) handle.style.left = '-5px';
                        if (position.includes('right')) handle.style.right = '-5px';

                        // Center handles
                        if (position === 'top-middle' || position === 'bottom-middle') {
                            handle.style.left = '50%';
                            handle.style.transform = 'translateX(-50%)';
                        } else if (position === 'left-middle' || position === 'right-middle') {
                            handle.style.top = '50%';
                            handle.style.transform = 'translateY(-50%)';
                        }

                        // Set cursor style based on position
                        switch (position) {
                            case 'top-left':
                                handle.style.cursor = 'nwse-resize'; // Diagonal resize
                                break;
                            case 'top-right':
                                handle.style.cursor = 'nesw-resize'; // Diagonal resize
                                break;
                            case 'bottom-left':
                                handle.style.cursor = 'nesw-resize'; // Diagonal resize
                                break;
                            case 'bottom-right':
                                handle.style.cursor = 'nwse-resize'; // Diagonal resize
                                break;
                            case 'top-middle':
                                handle.style.cursor = 'ns-resize'; // Vertical resize
                                break;
                            case 'bottom-middle':
                                handle.style.cursor = 'ns-resize'; // Vertical resize
                                break;
                            case 'left-middle':
                                handle.style.cursor = 'ew-resize'; // Horizontal resize
                                break;
                            case 'right-middle':
                                handle.style.cursor = 'ew-resize'; // Horizontal resize
                                break;
                        }

                        // Event listener for resizing
                        handle.addEventListener('mousedown', (e) => this._startResize(e, position));
                        this._container.appendChild(handle);
                    });
                }
            },


            _update: function () {
                if (!this._map) return;
                const zoom = this._map.getZoom();
                const scale = Math.pow(2, zoom - this.options.initZoom);
                const position = this._map.latLngToLayerPoint(this._latLng);

                const width = this.options.initialWidthMap * scale;
                const height = this.options.initialHeightMap * scale;

                this._container.style.width = width + 'px';
                this._container.style.height = height + 'px';
                L.DomUtil.setPosition(this._container, position.subtract([width / 2, height / 2]));
                this._container.style.display = 'block';
            },

            _startDrag: function (e) {
                if (this.options.dragging) {
                    this._map.dragging.disable();
                    this._dragging = true;
                    this._startPoint = this._map.latLngToLayerPoint(this._latLng);
                    this._startMousePoint = L.point(e.clientX, e.clientY);
                    document.addEventListener('mousemove', this._drag.bind(this));
                    document.addEventListener('mouseup', this._endDrag.bind(this));
                    e.preventDefault();
                }
            },

            _drag: function (e) {
                if (!this._dragging) return;
                const currentMousePoint = L.point(e.clientX, e.clientY);
                const offset = currentMousePoint.subtract(this._startMousePoint);
                const newPoint = this._startPoint.add(offset);
                this._latLng = this._map.layerPointToLatLng(newPoint);
                this._update();
            },

            _endDrag: function () {
                this._dragging = false;
                this._map.dragging.enable();
                document.removeEventListener('mousemove', this._drag.bind(this));
                document.removeEventListener('mouseup', this._endDrag.bind(this));
            },

            _startResize: function (e, position) {
                this._resize = true;
                this._initialMousePoint = L.point(e.clientX, e.clientY);
                this._initialWidth = this.options.initialWidthMap;
                this._initialHeight = this.options.initialHeightMap;

                document.addEventListener('mousemove', (e) => this._resizeOverlay(e, position));
                document.addEventListener('mouseup', this._endResize.bind(this));
                e.preventDefault();
            },

            _resizeOverlay: function (e, position) {
                if (!this._resize) return;

                const currentMousePoint = L.point(e.clientX, e.clientY);
                const widthDiff = currentMousePoint.x - this._initialMousePoint.x;
                const heightDiff = currentMousePoint.y - this._initialMousePoint.y;

                if (position.includes('right')) {
                    this.options.initialWidthMap = Math.max(50, this._initialWidth + widthDiff);
                } else if (position.includes('left')) {
                    this.options.initialWidthMap = Math.max(50, this._initialWidth - widthDiff);
                }

                if (position.includes('bottom')) {
                    this.options.initialHeightMap = Math.max(50, this._initialHeight + heightDiff);
                } else if (position.includes('top')) {
                    this.options.initialHeightMap = Math.max(50, this._initialHeight - heightDiff);
                }

                this._update();
            },

            _endResize: function () {
                this._resize = false;
                document.removeEventListener('mousemove', this._resizeOverlay.bind(this));
                document.removeEventListener('mouseup', this._endResize.bind(this));
            },

            enableDragging: function () {
                this.options.dragging = true;
                this._container.style.cursor = 'move';
            },

            disableDragging: function () {
                this.options.dragging = false;
                this._container.style.cursor = 'default';
            },

            enableEditing: function () {
                this.options.editing = true;
                this._createResizeHandles();
            },

            disableEditing: function () {
                this.options.editing = false;
                const handles = this._container.querySelectorAll('.resize-handle');
                handles.forEach(handle => handle.remove());
            }
        });
        const textBox = document.createElement('div');
        const title = document.createElement('h2');
        title.textContent = 'Thông tin';

        const content = document.createElement('p');
        content.textContent = 'Đây là nội dung bạn muốn hiển thị.';

        textBox.appendChild(title);
        textBox.appendChild(content);

        const htmlOverlay = new L.TextBox(textBox, latLng, {
            initialWidthMap: 200,
            initialHeightMap: 200,
            initZoom: 14,
            dragging: true,
            editing: true
        }).addTo(map);

    </script>
</body>

</html>